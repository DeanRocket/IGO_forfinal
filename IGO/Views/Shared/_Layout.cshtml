@using IGO.Controllers
@using Microsoft.AspNetCore.Http

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - IGO-訂票系統</title>
    @*<link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css" />
        <link rel="stylesheet" href="~/css/site.css" />*@

    <!-- Favicon -->
    @*<link href="img/favicon.ico" rel="icon">*@

    <!-- Google Web Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@400;500;600;700&family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet">

    <!-- Site CSS -->
    <link href="/css/site.css?v=@(DateTime.Now.ToString("yyyyMMddHHmmss"))" rel="stylesheet" />
    @*育緯新增*@

    <!-- Date picker plugins css -->
    <link href="~/lib/bootstrap-datepicker/bootstrap-datepicker.min.css" rel="stylesheet" type="text/css" />


    <!-- Icon Font Stylesheet -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.0/css/all.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.1/font/bootstrap-icons.css" rel="stylesheet">

    <!-- Libraries Stylesheet -->
    <link href="~/lib/animate/animate.min.css" rel="stylesheet">
    <link href="~/lib/owlcarousel/assets/owl.carousel.min.css" rel="stylesheet">
    <link href="~/lib/tempusdominus/css/tempusdominus-bootstrap-4.min.css" rel="stylesheet" />

    <!-- Customized Bootstrap Stylesheet -->
    <link href="~/css/bootstrap.min.css" rel="stylesheet">

    <!-- Template Stylesheet -->
    <link href="~/css/style.css" rel="stylesheet">

    <!-- font-awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css" integrity="sha512-KfkfwYDsLkIlwQp6LFnl8zNdLGxu9YAA1QvwINks4PhcElQSvqcyVLLD9aMhXd13uQjoXtEKNosOWaZqXgel0g==" crossorigin="anonymous" referrerpolicy="no-referrer" />

    @*宜潔新增*@
    <style>
        .message-fix {
            position: fixed;
            right: 20px;
            bottom: 420px;
            /* left: 50px;*/
            z-index: $zindex-fixed;
            font-size: 150%;
            color: orange;
        }

        .parking-fix {
            position: fixed;
            right: 20px;
            bottom: 280px;
            /* left: 50px;*/
            z-index: $zindex-fixed;
            font-size: 150%;
            color: orange;
        }

        .face-fix {
            position: fixed;
            right: 5px;
            bottom: 100px;
            /* left: 50px;*/
            z-index: $zindex-fixed;
            font-size: 150%;
            color: orange;
        }

        #chat {
            border: 1px solid black;
            width: 300px;
            position: fixed;
            bottom: 0px;
            right: 100px;
            background-color: aqua;
            z-index: 2;
        }
    </style>

    @await RenderSectionAsync("Styles", required: false)

</head>
<body>
    <!-- Header Start -->
    <div class="container-fluid bg-dark px-0">
        <div class="row gx-0 fixed-top">
            <div class="col-lg-3 bg-dark d-none d-lg-block">
                <a href="~/Home/Home" class="navbar-brand w-100 h-100 m-0 p-0 d-flex align-items-center justify-content-center">
                    <h1 class="m-0 text-primary text-uppercase">IGO</h1>
                </a>
            </div>
            <div class="col-lg-9">
                <div class="row gx-0 bg-dark d-none d-lg-flex">
                    <div class="col-lg-7 px-5 text-start">
                    </div>
                    <div class="col-lg-5 px-5 text-end">
                        <div class="d-inline-flex align-items-center py-2">
                        </div>
                    </div>
                </div>
                <nav class="navbar navbar-expand-lg bg-dark navbar-dark p-3 p-lg-0">
                    <a href="~/Home/Home" class="navbar-brand d-block d-lg-none">
                        <h1 class="m-0 text-primary text-uppercase">IGO</h1>
                    </a>

                    <div class="navbar-nav mr-auto py-0" id="category">

                    </div>
                    <div class="offcanvas offcanvas-start bg-warning" tabindex="-1" id="offcanvasExample" aria-labelledby="offcanvasExampleLabel">
                        <div class="offcanvas-header">
                            <h5 class="offcanvas-title" id="offcanvasExampleLabel"></h5>
                            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>

                        </div>
                        <div class="offcanvas-body bg-dark">
                            <div class="SubSpace">
                            </div>
                        </div>
                    </div>
                    @*7/28調整版面*@
                    <div class="col-sm-1 px-5 text-end">
                        <div class="d-inline-flex align-items-center py-2">
                        </div>
                    </div>
                    @*宜潔新增*@
                    <a href="/Coupon/List" class="nav-item nav-link" style="font-size:120%">特惠組合</a>
                    <a href="/Test/Index" class="nav-item nav-link" style="font-size:120%">玩樂性格測驗</a>

                    <div class="nav-item">
                        @{
                            if (Context.Session.Keys.Contains(CDictionary.SK_LOGINED_USER))
                            {
                                <a href="@Url.Content("~/ShoppingCart/List")">
                                    <i class="fa-solid fa-cart-plus"></i>
                                    <span style="font-size:120%">購物車</span><span style="color: #DEDEBE; font-size: 120%"></span>
                                </a>
                            }
                            else
                            {
                                <a href="#loginModal" data-bs-toggle="modal">
                                    <i class="fa-solid fa-cart-plus"></i>
                                    <span style="font-size:120%">購物車</span><span style="color: #DEDEBE; font-size: 120%"></span>
                                </a>

                            }

                        }

                    </div>
                    @{
                        if (Context.Session.Keys.Contains(CDictionary.SK_LOGINED_USER))
                        {
                            @*7/30修改畫面格式*@
                            <div class="col-lg-1 px-5"></div>
                            <div class="navbar-nav navbar-right mr-auto py-0 dropdown">
                                <a class="btn dropdown-toggle nav-item nav-link" href="/Customer/Index" role="button" id="dropdownMenuLink" data-bs-toggle="dropdown" aria-expanded="false">
                                    @if (CustomerController.imgpath == null)
                                    {
                                        <img width="50" height="50" class="rounded-circle " src="/img/UID_0.jpg">
                                    }
                                    else
                                    {
                                        <img width="50" height="50" class="rounded-circle " src="/img/@CustomerController.imgpath">
                                    }
                                </a>
                                <div class="dropdown-menu dropdown-menu-end" data-bs-popper="none">
                                    <ul class="dropdown-menu " aria-labelledby="dropdownMenuLink" width="80">
                                        @*7/26修改*@
                                        <li><a class="dropdown-item" href="~/Order/Order" id="order"><i class="fa-solid fa-list"></i> 我的訂單</a></li>
                                        <li><a class="dropdown-item" href="#"><i class="fa-solid fa-tags"></i> 優惠碼</a></li>
                                        <li><a class="dropdown-item" href="/Collection/myFavGroup"><i class="fa-solid fa-heart"></i> 我的收藏</a></li>
                                        <li><a class="dropdown-item" href="/Customer/UserData"><i class="fa-solid fa-gear"></i> 帳戶設定</a></li>
                                        <li><hr class="dropdown-divider"></li>
                                        <li><a class="dropdown-item" href="/Customer/Logout"><i class="fa-solid fa-right-from-bracket"></i> 登出</a></li>
                                    </ul>
                                </div>
                            </div>
                            <a href="#" class="btn btn-lg btn-primary btn-lg-square back-to-top"><i class="bi bi-arrow-up"></i></a>
                            <a href="#" class="message-fix" data-bs-toggle="collapse" data-bs-target="#collapseExample" aria-expanded="false" aria-controls="collapseExample"><img src="~/img/robot.png" title="客服小幫手" /><p style="font-size:14px;font-weight:bold">客服小幫手</p></a>
                            <a href="/CheckTicket/Capture" class="face-fix"><img src="~/img/face.png" title="入場票卷辨識" width="50" height="50" /><p style="font-size:14px; font-weight: bold">入場票卷辨識</p></a>
                            <a href="/Parking/Parking" class="parking-fix"><img src="~/img/parking.png" title="尋找停車位" /><p style="font-size:14px; font-weight: bold">尋找停車位</p></a>

                        }
                        else
                        {
                            @*7/30修改畫面格式*@
                            <div class="col-lg-1 px-5"></div>
                            @*7/28刪掉登入的框線*@
                            <div class="navbar-nav navbar-right mr-auto py-0 ">
                                <button type="button" class="btn btn-lg text-warning" data-bs-toggle="modal" data-bs-target="#loginModal">
                                    <i class="fa fa-user"> 登入/ 註冊 </i>
                                </button>
                            </div>
                            <br />
                            <br />
                            <br />
                            <br />
                            <a href="#" hidden class="btn btn-lg btn-primary btn-lg-square back-to-top"><i class="bi bi-arrow-up"></i></a>
                            <a href="#" hidden class="message-fix" data-bs-toggle="collapse" data-bs-target="#collapseExample" aria-expanded="false" aria-controls="collapseExample"><img src="~/img/robot.png" title="客服小幫手" /><p style="font-size:14px;font-weight:bold">客服小幫手</p></a>
                            <a href="/Parking/Parking" hidden class="parking-fix"><img src="~/img/parking.png" title="尋找停車位" /><p style="font-size:14px; font-weight: bold">尋找停車位</p></a>
                        }
                    }

                    <a href=""></a>

                </nav>
            </div>
        </div>
    </div>
    <!-- Header End -->
    <!--<div class="container-xxl py-5">-->
    @*使下面部分不會被擋住*@
    <!--</div>-->
    <div class="container-xxl py-5" id="startnow">
        使下面部分不會被擋住
    </div>
    @*次分類*@
    @*<div id="subcategory" style="background-color: #E0E0E0" class="fixed-top">
            <div class="collapse" id="collapseExample">
                <div class="card card-body"></div>
            </div>
        </div>*@


    @*聊天室*@

    <div id="chat">
        <div>
            <div class="collapse" id="collapseExample" style="position:absolute;bottom:0; width:100%">
                <h4 hidden>個人 ID: <span id="SelfID"></span></h4>
                <div class="card card-body" style="width:100%;height:500px">
                    <div style="background-color:coral">
                        <h6>客服小幫手</h6>
                    </div>
                    <div id="context" style="width:100% ;height:90%;border:2px solid black;overflow:auto">
                        <ul class="list-group" id="Content" style="bottom:auto">
                        </ul>
                    </div>
                    <div id="inputspace">
                        <input type="text" class="form-control float-lg-left" id="message1" style="width:85%"><i class="fa-solid fa-paper-plane float-lg-end" style="margin:10px;font-size:130%" id="sendButton"></i>
                    </div>
                </div>
            </div>

        </div>
    </div>

    @RenderBody()


    <!-- Footer Start -->
    <div class="container-fluid bg-dark text-light footer wow fadeIn" data-wow-delay="0.1s">
        <div class="container pb-5">
            <div class="row g-5">
                <div class="col-md-10 col-lg-4">
                    <div class="bg-primary rounded p-4">
                        <a href="index.html"><h1 class="text-white text-uppercase mb-3">IGO</h1></a>
                        <p class="text-white mb-0">
                            <a class="text-dark fw-medium" href="https://htmlcodex.com/hotel-html-template-pro"></a>
                    </div>
                </div>
                <div class="col-md-10 col-lg-3 justify-content-xxl-center">
                    <h6 class="section-title text-start text-primary text-uppercase mb-4">聯絡我們</h6>
                    <p class="mb-2"><i class="fa fa-map-marker-alt me-3"></i>台北市大安區復興南路1段390號2樓</p>
                    <p class="mb-2"><i class="fa fa-phone-alt me-3"></i>02-66316588</p>
                    <p class="mb-2"><i class="fa fa-envelope me-3"></i>info@example.com</p>
                    <div class="d-flex pt-5">
                        <a class="btn btn-outline-light btn-social m-4 text-primary" href="https://www.instagram.com/igo_taiwan/" style="font-size:150%"><i class="fa-brands fa-instagram-square"></i></a>
                        <a class="btn btn-outline-light btn-social m-4 text-primary" href="" style="font-size:150%"><i class="fa-brands fa-facebook-square"></i></a>
                        @*7/29宜潔新增line的連結*@
                        <a class="btn btn-outline-light btn-social m-4 text-primary" href="https://liff.line.me/1645278921-kWRPP32q/?accountId=461pumfj" style="font-size:150%"><i class="fa-brands fa-line"></i></a>
                    </div>
                </div>
                <div class="col-lg-5 col-md-12 justify-content-xxl-center">
                    <div class="row gy-5 g-4">
                        <div class="col-md-10">
                            <h6 class="section-title text-start text-primary text-uppercase mb-4">IGO</h6>
                            <a class="btn btn-link" href="/About/index">關於IGO</a>
                            <a class="btn btn-link" href="/About/Helper">幫助中心</a>
                            <a class="btn btn-link" href="/About/HelpByUsage">隱私權</a>

                            <a href="/Admin/Coupon/List" class="btn btn-link">管理後台</a>
                            @*<a class="btn btn-link" data-bs-toggle="modal" data-bs-target="#BackendModal">管理後台</a>*@

                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="container">
            <div class="copyright">
                <div class="row">
                    <div class="col-md-6 text-center text-md-start mb-3 mb-md-0">
                        &copy; <a class="border-bottom" href="#">IGO</a>, All Right Reserved.

                        <!--/*** This template is free as long as you keep the footer author’s credit link/attribution link/backlink. If you'd like to use the template without the footer author’s credit link/attribution link/backlink, you can purchase the Credit Removal License from "https://htmlcodex.com/credit-removal". Thank you for your support. ***/-->
                        @*Designed By*@ <a class="border-bottom" href="https://htmlcodex.com">@*HTML Codex*@</a>
                        <br>@*Distributed By:*@ <a class="border-bottom" href="https://themewagon.com" target="_blank">@*ThemeWagon*@</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Footer End -->
    <!--=============== 鈞傑新增 Login & Register =========================== -->
    <!-- Login Modal 彈出登入視窗 -->
    <div class="modal fade " id="loginModal" data-bs-backdrop="static" tabindex="-1" role="dialog" aria-labelledby="staticBackdropLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content bg-dark">
                <div class="modal-header">
                    <h5 class="modal-title text-warning" id="staticBackdropLabel">登入 IGO</h5>
                    <button type="button" class="btn-close-white btn-danger text-white-50" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body bg-dark">
                    <br />
                    <form asp-controller="Customer" asp-action="Login" method="post" enctype="application/x-www-form-urlencoded" name="userInfo" id="loginForm">
                        <input name="ReturnUrl" id="inpReturnUrl" type="hidden" />
                        <div class="form-floating mb-4">
                            <input type="text" class="form-control text-dark" id="Login_txtAcc" name="txtAccount" placeholder="請輸入手機號碼" autocomplete="off">
                            <label for="floatingInput">帳號 (手機號碼)</label>
                        </div>
                        <br />
                        <div class="form-floating mb-4">
                            <input type="password" class="form-control text-dark" id="Login_txtPwd" name="txtPassword" placeholder="請輸入密碼" autocomplete="off">
                            <label for="floatingPassword">密碼</label>
                        </div>
                        <div class="form-floating mb-4">
                            <span id="spwarn" class="text-danger"></span> @*錯誤訊息*@
                        </div>
                        <div class="d-flex align-items-center justify-content-between mb-4">
                            <div class="form-check text-white">
                                <input type="checkbox" class="form-check-input" id="reAccount">
                                <label class="form-check-label" for="exampleCheck1 ">記住帳號</label>
                            </div>
                            <button type="button" class="btn btn-link" data-bs-toggle="modal" data-bs-target="#MailforgetPwd" data-bs-dismiss="modal">忘記密碼</button>
                        </div>
                        <h5 class="text-sm-center mb-0 text-white"> 新朋友 ? <button type="button" class="btn btn-outline-primary" data-bs-toggle="modal" data-bs-target="#registerModal" data-bs-dismiss="modal">立即註冊 IGO !</button></h5>
                        <br />
                        <div class="modal-footer">
                            <br />
                            <button class="btn btn-primary" id="btnLoginModal"><i class="fa fa-sign-in" aria-hidden="true"></i> 登入</button>
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal"> 返回首頁 </button>
                            <br />
                        </div>
                        <br />
                        <div class="form-group">
                            <hr />
                            <div>
                                <div class="row bg-dark">
                                    <div class="col text-center">
                                            <button type="button" class="btn btn-danger" id="btnDemo1">  Demo(管理員) </button>
                                        </div>
                                    <div class="col text-center">
                                        <button type="button" class="btn btn-danger" id="btnDemo2">  Demo(戴樂古) </button>
                                    </div>
                                    <div class="col text-center">
                                        <button type="button" class="btn btn-danger" id="btnDemo3">  Demo(註冊完) </button>
                                    </div>
                                </div>
                            </div>
                            <hr />
                            <div class=" bg-dark">
                                <br />
                                <h5 class="text-white text-center">使用其他帳號登入</h5>
                                <br />
                                <div class="row bg-dark">
                                    <div class="col text-center">
                                        <img class="rounded rounded-circle me-lg-2" src="/img/icon_FB.png" alt="icon" style="width: 55px; height:55px;">
                                    </div>
                                    <div class="col text-center">
                                        <img class="rounded rounded-circle me-lg-2" src="/img/icon_G.png" alt="icon" style="width: 55px; height:55px;">
                                    </div>
                                    <div class="col text-center">
                                        <img class="rounded rounded-circle me-lg-2" src="/img/icon_L.png" alt="icon" style="width: 55px; height:55px;">
                                    </div>
                                </div>
                                <br />
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <!-- Login Modal End -->
    <!-- Register Modal 彈出註冊視窗 -->
    <div class="modal fade " id="registerModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <form asp-action="Register" asp-controller="Customer" id="registerForm">
                <div class="modal-content bg-dark">
                    <div class="modal-header text-center">
                        <h5 class="modal-title text-warning" id="rlblWelcome">歡迎加入 IGO 會員</h5>
                        <button type="button" class="btn-close-white btn-danger text-white-50" data-bs-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body bg-dark">
                        <br />
                        <div class="form-floating mb-3">
                            <input type="text" class="form-control text-dark" id="register_FPhone" name="FPhone" placeholder="手機號碼(IGO 帳號)" />
                            <label for="FPhone" class="control-label">手機號碼(IGO 帳號)</label>
                            <span id="R_warn_Acc" class="text-danger"></span>
                        </div>
                        <div>
                            <div class="row">
                                <div class="col">
                                    <div class="form-floating mb-3">
                                        <input type="text" class="form-control text-dark" id="register_FLName" name="FLastName" placeholder="姓氏(LastName)" />
                                        <label for="FLastName">姓氏(LastName)</label>
                                        <span id="R_warn_LN" class="text-danger"></span>
                                    </div>
                                </div>
                                <div class="col">
                                    <div class="form-floating mb-3">
                                        <input type="text" class="form-control text-dark" id="register_FFName" name="FFirstName" placeholder="名字(FirstName)" />
                                        <label for="FFirstName" class="control-label">名字(FirstName)</label>
                                        <span id="R_warn_FN" class="text-danger"></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="form-floating mb-3">
                            <input type="password" class="form-control text-dark" id="register_FPassword" name="FPassword" placeholder="密碼">
                            <label for="FPassword">密碼</label>
                            <span id="spwarn_Pwd" class="text-danger"></span>
                        </div>
                        <div class="form-floating mb-3">
                            <input type="password" class="form-control text-dark" id="register_FCheckPwd" name="confirmPassword" placeholder="確認密碼" />
                            <label for="confirmPassword">請確認密碼</label>
                            <span id="confirmPwd" class="text-danger"></span>
                        </div>
                        <div class="form-floating mb-3">
                            <input type="text" class="form-control text-dark" id="register_FEmail" name="FEmail" placeholder="E-Mail" />
                            <label for="FEmail" class="control-label">E-Mail</label>
                            <span id="R_warn_Email" class="text-danger"></span>
                        </div>
                    </div>
                    <div class="modal-footer bg-dark">
                        <div class="form-group">
                            <button id="btnRegister" class="btn btn-primary"><i class="fa fa-paper-plane" aria-hidden="true"></i> 註冊 IGO</button>
                        </div>
                        <div>
                            <button type="button" class="btn btn-secondary" data-bs-toggle="modal" data-bs-target="#loginModal" data-bs-dismiss="modal">
                                <i class="fa fa-user"> 返回登入頁面 </i>
                            </button>
                        </div>
                    </div>
                    <div class="form-group">
                        <hr />
                        <div>
                            <div class="row bg-dark">
                                <div class="col text-center">
                                    <button type="button" class="btn btn-danger" id="btnDemoRegister">  Demo (林炙影) </button>
                                </div>
                            </div>
                            <hr />
                            <div class=" bg-dark">
                                <br />
                                <h5 class="text-white text-center">使用其他社群帳號註冊</h5>
                                <br />
                                <div class="row bg-dark">
                                    <div class="col text-center">
                                        <img class="rounded rounded-circle me-lg-2" src="/img/icon_FB.png" alt="icon" style="width: 55px; height:55px;">
                                    </div>
                                    <div class="col text-center">
                                        <img class="rounded rounded-circle me-lg-2" src="/img/icon_G.png" alt="icon" style="width: 55px; height:55px;">
                                    </div>
                                    <div class="col text-center">
                                        <img class="rounded rounded-circle me-lg-2" src="/img/icon_L.png" alt="icon" style="width: 55px; height:55px;">
                                    </div>
                                </div>
                                <br />
                            </div>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>
    <!-- Register Modal End -->
    <!-- ForgetPwd Modal 彈出登入視窗 -->
    <div class="modal fade " id="MailforgetPwd" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content bg-dark">
                <div class="modal-header">
                    <h5 class="modal-title text-warning" id="rePwd_lbl">重新設定密碼</h5>
                    <button type="button" class="btn-close-white btn-danger text-white-50" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body bg-dark">
                    <br />

                    <form asp-controller="Customer" asp-action="MailforgetPwd" method="post">
                        <div class="form-floating mb-3">
                            <input type="text" class="form-control text-dark" id="rePwd_FPhone" name="Phone" placeholder="手機號碼">
                            <label for="floatingInput">帳號 (手機號碼)</label>
                        </div>
                        <br />
                        <div class="form-floating mb-4">
                            <input type="text" class="form-control text-dark" id="rePwd_FEmail" name="Email" placeholder="Email">
                            <label for="floatingPassword">Email</label>
                        </div>
                        <div class="modal-footer">
                            <br />
                            <input type="submit" value="確認" class="btn btn-primary" id="Forgetmail" />
                            <button type="button" class="btn btn-secondary" data-bs-toggle="modal" data-bs-target="#loginModal" data-bs-dismiss="modal">
                                返回登入頁面
                            </button>
                            <br />
                        </div>

                        <div class="form-group">
                            <hr />
                            <div>
                                <div class="row bg-dark">
                                    <div class="col text-center">
                                        <button type="button" class="btn btn-danger" id="btnDemoForgotPassword">  Demo </button>
                                    </div>
                                </div>
                            </div>
                            <hr />
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <!-- ForgetPwd Modal 彈出登入視窗 -->
    <!-- Backend Modal 彈出登入視窗 -->
    <div class="modal fade " id="BackendModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content bg-dark">
                <div class="modal-header">
                    <h5 class="modal-title text-warning" id="staticBackdropLabel">後臺管理員登入系統</h5>
                    <button type="button" class="btn-close-white btn-danger text-white-50" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body bg-dark">
                    <br />
                    <form asp-controller="" asp-action="" enctype="application/x-www-form-urlencoded"  id="loginBEForm">
                        <div class="form-floating mb-3">
                            <input type="text" class="form-control text-dark" id="LoginBE_txtAcc" name="txtAccount" placeholder="手機號碼">
                            <label for="floatingPassword">管理員帳號</label>
                        </div>
                        <br />
                        <div class="form-floating mb-4">
                            <input type="password" class="form-control text-dark" id="LoginBE_txtPwd" name="txtPassword" placeholder="密碼">
                            <label for="floatingPassword">密碼</label>
                        </div>
                        <div class="form-floating mb-4">
                            <span id="spBEwarn" class="text-danger"></span> @*錯誤訊息*@
                        </div>
                        <div class="modal-footer">
                            <br />
                            @*<input type="submit" value="後台登入" class="btn btn-primary" id="btnLoginBEModal" />*@
                            <a href="/Admin/Coupon/List" class="btn btn-primary">後台登入</a>
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal"> 返回首頁 </button>
                            <br />
                        </div>
                        <br />
                        <div class="form-group">
                            <hr />
                            <div>
                                <div class="row bg-dark">
                                    <div class="col text-center">
                                        <button type="button" class="btn btn-danger" id="Backend_Demo">  Demo </button>
                                    </div>
                                </div>
                            </div>
                            <hr />
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <!-- Backend Modal End -->
    <!--=============== 鈞傑新增 Login & Register ==========END============== -->
    <!-- Back to Top -->
    @*7/28新增入場票券辨識*@

    <!-- JavaScript Libraries -->
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <script src="~/lib/wow/wow.min.js"></script>
    <script src="~/lib/easing/easing.min.js"></script>
    <script src="~/lib/waypoints/waypoints.min.js"></script>
    <script src="~/lib/counterup/counterup.min.js"></script>
    <script src="~/lib/owlcarousel/owl.carousel.min.js"></script>
    <script src="~/lib/tempusdominus/js/moment.min.js"></script>
    <script src="~/lib/tempusdominus/js/moment-timezone.min.js"></script>
    <script src="~/lib/tempusdominus/js/tempusdominus-bootstrap-4.min.js"></script>
    <script src="https://unpkg.com/vue@3"></script>

    <script src="~/js/signalr/dist/browser/signalr.js"></script>
    <script src="~/lib/bootstrap-datepicker/bootstrap-datepicker.min.js"></script>

    @*商品地圖使用*@
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAaLWLgpzbDMkQXzEcjYDWEAbPeSwfsx7U&libraries=geometry,places"
            type="text/javascript">
    </script>

    <!-- Template Javascript -->
    <script src="~/js/main.js"></script>
    <script src="~/js/site.js" asp-append-version="true"></script>
    <script>
        //顯示主分類
        let CategoryIDArray = new Array();
        window.addEventListener("DOMContentLoaded", ShowCategory);
        async function ShowCategory() {

            let Response = await fetch('@Url.Content("~/Home/layoutCategory")');
            /*console.log(Response);*/
            let Datas = await Response.json();
           /* console.log(Datas);*/

            let DivCategory = document.querySelector("#category");

            for (let i = 0; i < Datas.length; i++)
            {
                let CategoryName = Datas[i].CategoryName;
                let CategoryId = Datas[i].CategoryId;

                CategoryIDArray[i] = CategoryId;
                //console.log(CategoryIDArray[i]);
                //console.log(CategoryName);
                //console.log(CategoryId);

               /* $(DivCategory).append(`<a class="btn-card" CategoryID=${CategoryId} style="margin-right:25px; color:white" data-bs-toggle="collapse" href="#collapseExample" role="button" aria-expanded="false" aria-controls="collapseExample">${CategoryName}</a>`);*/
                $(DivCategory).append(`<button class="btn btn-card" type="button" style="color:white" data-bs-toggle="offcanvas" data-bs-target="#offcanvasExample" aria-controls="offcanvasExample" CategoryID=${CategoryId}>${CategoryName}</button>`);
            }

            //顯示次分類
            $(".btn-card").click(function () {
                $.getJSON('@Url.Content("~/Home/layoutSubCategory")', { "idd": $(this).attr("CategoryID") },
                    function (datas) {
                        $(".SubSpace").empty();
                        //console.log(datas);
                        //console.log(datas.subCategoryNameList);
                        $.each(datas, function (idx, item) {
                            //console.log(item);
                            //console.log(idx);

                            //$(".card-body").append(item + "<hr/>"); //寫法1
                            $(".SubSpace").append(`<a class="btn btn-secondary justify-item-center" href="${item.SubCategoryPath}" type="button">${item.SubCategoryName}<a><hr/>`); //寫法2
                        })

                    })
            })
        };
        //===================================================
                //點閱後瀏覽次數增加 7/27新增
        $(window).ready(function ()
         {
            if (window.location.href.indexOf("prodid=") > -1) {
                //console.log(window.location.href);
                let querystring = window.location.search;
                let productIDstring = querystring.split("=");
                let productID = productIDstring[1];
                //console.log(productID);


                $.get('@Url.Content("~/Home/AddViewRecord")', { "Productid": productID }, function (Datas) {
                    //console.log(Datas)
                });

            }
            })
         //===================================================


        //==============宜璟聊天室===============
         var connection = new signalR.HubConnectionBuilder().withUrl("/chatHub").build();

        //與Server建立連線
        connection.start().then(function () {
            console.log("Hub 連線完成");
        }).catch(function (err) {
            alert('連線錯誤: ' + err.toString());
        });

        // 更新連線 ID 列表事件
        connection.on("UpdList", function (jsonList) {
            var list = JSON.parse(jsonList);
            $("#IDList li").remove();
            for (i = 0; i < list.length; i++) {
                $("#IDList").append($("<li></li>").attr("class", "list-group-item").text(list[i]));
            }
        });

        // 更新用戶個人連線 ID 事件
        connection.on("UpdSelfID", async function (id) {
            let juserName = await fetch('@Url.Content("/Hubs/getUserName")');
            let userName = await juserName.json();

            //console.log("AA");
            console.log(userName);
            id = userName;
            console.log(id);
            $('#SelfID').html(id);

       });
        // 更新聊天內容事件
        connection.on("UpdContent", function (msg) {
            $("#Content").append($("<li></li>").attr("class", "list-group-item").text(msg));
        });

        //傳送訊息
        $('#sendButton').on('click', function () {
            let selfID = $('#SelfID').html();
            let message = $('#message1').val();
            let sendToID = $('#sendToID').val();
            connection.invoke("SendMessage", selfID, message, sendToID).catch(function (err) {
                alert('傳送錯誤: ' + err.toString());
            });
        });
    </script>

    <!--========================================================登入系統用script================================ -->
    <script>


        //--  Login======================================================================================== -- >

        //密碼顯示切換

        $("#showPassword").click(function () {
            if ($(this).hasClass("fa-eye-slash")) {
                $(this).removeClass("fa-eye-slash").addClass("fa-eye");
                $("#Login_txtPwd").attr("type", "text");
            }
            else {
                $(this).removeClass("fa-eye").addClass("fa-eye-slash");
                $("#Login_txtPwd").attr("type", "password");
            }
        });

        //偵測密碼

        const btnUserName = document.querySelector('#btnLoginModal');
        btnUserName.addEventListener('click', (event) => {
            event.preventDefault();
            var formData = new FormData(document.querySelector("#loginForm"));
            fetch("/Customer/Login", {
                body: formData,
                method: "Post"
            }).then(Response => Response.text()).then(data => {

                if (data == "empty") {
                    $("#spwarn").html('<i class="fa-solid fa-circle-xmark"> 請輸入帳號或密碼</i>');
                }

                else if (data == "false") {
                    alert("輸入的帳號密碼錯誤，請重新嘗試登入");
                    $("#spwarn").html('<i class="fa-solid fa-circle-xmark"> 輸入的帳號密碼錯誤</i>');
                    $('#Login_txtAcc').val("");
                    $('#Login_txtPwd').val("");
                }

                else if (data == "success") {
                    $('#loginModal').modal('hide');
                    window.location.reload(true);//refresh page
                    alert("帳號密碼正確，登入成功");
                    $('#Login_txtAcc').val("");
                    $('#Login_txtPwd').val("");
                }

            });
        });

        //登入Demo

        $("#btnDemo1").click(function () {
            $("#Login_txtAcc").val("0912345678");
            $("#Login_txtPwd").val("a12345678");
        });
        $("#btnDemo2").click(function () {
            $("#Login_txtAcc").val("0931000013");
            $("#Login_txtPwd").val("a12345678");
        });
        $("#btnDemo3").click(function () {
            $("#Login_txtAcc").val("0911911990");
            $("#Login_txtPwd").val("123");
        });

        //--  Register===================================================================================== -- >

        //註冊日期
        //var registerD = new Date();
        //var year = registerD.getFullYear().toString();
        //var month = (registerD.getMonth() + 101).toString().substring(1);
        //var day = (registerD.getDate() + 100).toString().substring(1);
        //var str = year + month + day;
        //$("#fRegisterDate").val(str);

        //
        $('#register_FPhone').on('blur', () => {
            event.preventDefault();
            $('#register_FPhone').empty();

            var mobileRegex = /^09[0-9]{8}$/
            var RegAcc = mobileRegex.test($('#register_FPhone').val());

            if (RegAcc) {
                $("#R_warn_Acc").html('<i class="fa fa-check-circle text-success" style="color:#4bf33"></i>');
            }

            else {
                $("#R_warn_Acc").html('<i class="fa-solid fa-circle-xmark"> 手機號碼空白或格式有誤</i>');
            }
        });

        $('#register_FLName').on('blur', () => {
            event.preventDefault();
            $('#register_FLName').empty();

            var RecLName = $('#register_FLName').val();
            if (RecLName != "") {
                $("#R_warn_LN").html('<i class="fa fa-check-circle text-success" style="color:#4bf33"></i>');
            }
            else {
                $("#R_warn_LN").html('<i class="fa-solid fa-circle-xmark"> 請填入您的姓氏</i>');
            }
        });

        $('#register_FFName').on('blur', () => {
            event.preventDefault();
            $('#register_FFName').empty();

            var RecLName = $('#register_FFName').val();
            if (RecLName != "") {
                $("#R_warn_FN").html('<i class="fa fa-check-circle text-success" style="color:#4bf33"></i>');
            }
            else {
                $("#R_warn_FN").html('<i class="fa-solid fa-circle-xmark"> 請填入您的名字</i>');
            }
        });

        $('#register_FPassword').on('blur', () => {
            event.preventDefault();
            $('#register_FPassword').empty();

            var regEx = /^(?=.*\d)(?=.*[a-z]).{8,20}$/; //密碼格式 至少有數字+一個字母，字串8~20
            var RegPwd = regEx.test($('#register_FPassword').val());

            if (RegPwd) {
                $("#spwarn_Pwd").html('<i class="fa fa-check-circle text-success" style="color:#4bf33"></i>');
            }
            else {
                $("#spwarn_Pwd").html('<i class="fa-solid fa-circle-xmark"> 密碼空白或格式不符</i>');
            };
        });

        $('#register_FCheckPwd').on('blur', () => {
            event.preventDefault();
            console.log("123");
            $('#confirmPwd').empty();

            var firstPassword = $('#register_FPassword').val();
            var confirmPassword = $('#register_FCheckPwd').val();

            if (confirmPassword !== firstPassword) {
                $("#confirmPwd").html('<i class="fa-solid fa-circle-xmark"> 與輸入的密碼不一致</i>');
            }
            else {
                $("#confirmPwd").html('<i class="fa fa-check-circle text-success" style="color:#4bf33"></i>');
            }
        });

        $('#register_FEmail').on('blur', () => {
            event.preventDefault();
            $('#register_FEmail').empty();

            var RecLName = $('#register_FFName').val();
            if (RecLName != "") {
                $("#R_warn_Email").html('<i class="fa fa-check-circle text-success" style="color:#4bf33"></i>');
            }
            else {
                $("#R_warn_Email").html('<i class="fa-solid fa-circle-xmark"> 請填入Email</i>');
            }
        });


        const btn = document.querySelector('#btnRegister');
        btn.addEventListener('click', (event) => {
            event.preventDefault();
            var formData = new FormData(document.querySelector("#registerForm"));
            fetch("/Customer/Register", {
                body: formData,
                method: "Post"
            }).then(Response => Response.text()).then(data => {

                {
                    if (data == "欄位空白") {
                        alert("註冊失敗，欄位不可空白請正確填入!");
                    }
                    else if (data == "此電話已有人使用") {
                        alert("註冊失敗，此號碼已有人使用!")
                        $("#R_warn_Acc").html('<i class="fa-solid fa-circle-xmark"> 此號碼已有人使用</i>');
                    }
                    else if (data == "此信箱已有人使用") {
                        alert("註冊失敗，此信箱已有人使用!")
                        $("#R_warn_Email").html('<i class="fa-solid fa-circle-xmark"> 此Email已有人使用</i>');
                    }
                    else {
                        alert("註冊成功，歡迎您成為IGO會員!")
                        $('#registerModal').modal('hide');
                        $('#loginModal').modal('show');
                    }
                }
            });
        });

        //註冊Demo
        $("#btnDemoRegister").click(function () {
            $("#register_FPhone").val("0911911990");
            $("#register_FLName").val("林");
            $("#register_FFName").val("炙影");
            $("#register_FPassword").val("a8226520");
            $("#register_FCheckPwd").val("");
            $("#register_FEmail").val("igocompanysender@gmail.com");
        });


        //--  忘記密碼===================================================================================== -- >

                //忘記密碼寄信
        $("#Forgetmail").click(function (event) {
            event.preventDefault();
            let phone = document.querySelector("#rePwd_FPhone").value;
            let email = document.querySelector("#rePwd_FEmail").value;
            $.post('@Url.Content("~/Customer/MailforgetPwd")'+`?Phone=${phone}&Email=${email}`,

                function (result) {
                    alert(result);
                })
            console.log('send');
        })

        //忘記密碼Demo
        $("#btnDemoForgotPassword").click(function () {
            $("#rePwd_FPhone").val("0911911990");
            $("#rePwd_FEmail").val("igocompanysender@gmail.com");
        });

        //--  後台Login==================================================================================== -- >

        //後台登入Demo
        $("#Backend_Demo").click(function () {
            $("#LoginBE_txtAcc").val("0912345678");
            $("#LoginBE_txtPwd").val("a12345678");
        });

    </script>
    <!--=============================================登入系統用 script ======================================END -->

    @await RenderSectionAsync("Scripts", required: false)
</body>
</html>


