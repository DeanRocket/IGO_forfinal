
@model List<IGO.ViewModels.COrdersViewModel>

@section Styles
{
    <style>
        a.disabled {
            pointer-events: none;
            cursor: default;
            color: gray;
        }
    </style>
}
<ul class="nav nav-tabs mb-3 container-xxl py-5" style="margin-top:100px" id="myTab" role="tablist">
    <li class="nav-item" role="presentation">
        <button class="nav-link active" id="home-tab" data-bs-toggle="tab" data-bs-target="#home" type="button" role="tab" aria-controls="home" aria-selected="true"> 訂單狀態查詢</button>
    </li>
</ul>
@*目前訂單*@
@{ int count = 0;
    string taq1 = "";
    string taq2 = "";
    string taq3 = "";
    string taq4 = "";}
<div class="tab-content  container-md py-5">
    @foreach (var item in Model)
    {
        if (item.StatusId == 1)
        {
            taq1 = "btn";
            taq2 = "btn-danger";
            taq3 = "訂單取消申請";
            taq4 = "btnCancel";
        }
        else
        {
            taq1 = "";
            taq2 = "";
            taq3 = "無法取消";
            taq4 = "";
        }
        <div class="tab-pane active" id="home" role="tabpanel" aria-labelledby="home-tab" tabindex="0">
            <table class="table table-striped justify-content-sm-center">
                <thead class="justify-content-sm-center">
                    <tr align="right"> <th> 訂單日期</th> <th> 訂單編號</th> <th> 訂單狀態</th> <th> 訂購總額</th> <th> </th> </tr>
                </thead>
                <tbody class="justify-content-sm-center">
                    <tr align="right"> <td> @Convert.ToDateTime(item.OrderDate) </td> <td>@item.OrderNum </td> <td>@item.StatusName </td> <td>@String.Format("{0:C0}", item.TotalPrice) </td> <td> <a class="@taq1 @taq2 @taq4" id="Order-@item.OrderId">@taq3 </a> </td> </tr>
                    <tr>
                        <th>
                            <button type="button" class="btn btn-primary btnOrderdetail" data-bs-toggle="modal" data-bs-target="#exampleModal" id="Order-@item.OrderId">
                                詳細訂單明細
                            </button>
                            <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                <div class="modal-dialog modal-lg">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                            <h5 class="modal-title" id="exampleModalLabel"> 訂單明細</h5>
                                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"> </button>
                                        </div>
                                        <div class="modal-body">
                                            <table class="table table-striped">
                                                <thead>
                                                    <tr> <th> 產品</th> <th> 數量</th> <th> 票種</th> <th> 金額</th> </tr>
                                                </thead>
                                                <tbody id="orderdetailTable-@count" class="showDetail">
                                                </tbody>
                                            </table>
                                        </div>
                                        <div class="modal-footer">
                                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal"> Close</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </th>
                    </tr>
                </tbody>
            </table>
        </div>
        count++;
    }
</div>
@*Bottom*@
<div class="container newsletter mt-5 wow fadeIn" data-wow-delay="0.1s">
    <div class="row justify-content-center">
        <div @*class="col-lg-10 border rounded p-1"*@>
            <div @*class="border rounded text-center p-1"*@>
                <div class="bg-transparent rounded text-center p-5">
                    <h4 class="mb-4">@*Subscribe Our*@ <span class="text-primary text-uppercase">@*Newsletter*@ </span> </h4>
                    <div @*class="position-relative mx-auto"*@ style="max-width: 400px;">
                        @*<input class="form-control w-100 py-3 ps-4 pe-5" type="text" placeholder="Enter your email">
                            <button type="button" class="btn btn-primary py-2 px-3 position-absolute top-0 end-0 mt-2 me-2">Submit</button>*@
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
@*Bottom*@
@section Scripts{
    <script>
        //訂單明細Modal
        const firstTabEl = document.querySelector('#myTab li:last-child button')

        //取消訂單
        $(".btnCancel").click(function ()
        {
            console.log("取消申請中");
            $(this).text("取消申請中");
            $(this).attr("class", "disabled");
            let orderid = $(this).attr("id");
            console.log(orderid);
            $.get('@Url.Content("~/Order/EditOrderStatus")', { "Orderid": orderid }, function (datas)
            {
                console.log(datas);
            })

        });

    $('.btnOrderdetail').click(function () {
                $('.showDetail').empty();
                let orderid = $(this).attr("id");
                console.log($(this).attr("id"));
                $.get('@Url.Content("~/Order/OrderDetailList")', { "Orderid": orderid },
                    function (datas)
                    {
                        console.log(datas);
                        $.each(datas, function (idx, item)
                        {
                            console.log(item);
                            console.log(item.ticketName);
                            console.log(item.productName);
                            console.log(item.quantity);
                            console.log(item.price);

                            $(`#orderdetailTable-${idx}`).append(`<tr><td>${item.productName}</td><td>${item.ticketName}</td><td>${item.quantity}</td><td>${item.price}元</td></tr>`);
                        })
                    })
            })
    </script>
}


