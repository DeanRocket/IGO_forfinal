@model IEnumerable<IGO.ViewModels.CCategoryViewModel>

@{
    ViewData["Title"] = "List";
}

<h4>商品類別管理</h4>
<br>
<p>
    <button type="button" class="btn btn-light btnCreate" data-bs-toggle="modal" data-bs-target="#exampleModal">
        新增商品主類別
    </button>
</p>
<!-- Modal -->
@*<form name="categoryInfo" method="post" enctype="application/x-www-form-urlencoded">*@ @*寫法2:*@
<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">新增商品主類別</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <label>輸入主類別名稱</label><span>: </span><input class="form-text" id="txtCategory" type="text" value="">
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" id="update">新增</button>
            </div>
        </div>
    </div>
</div>
@*</form>*@
<table class="table table-dark">
    <thead>
        <tr align="right">
            <th>
                商品主類別名稱
            </th>
            <th>

            </th>

            <th></th>
        </tr>
    </thead>
    <tbody>
        @foreach (var item in Model)
        {
            <tr align="right">
                <td>
                    @item.CategoryName
                </td>
                <td>
                    <button type="button" class="btn btn-info btnEdit" data-bs-toggle="modal" data-bs-target="#exampleModal2" id="CategoryId-@item.CategoryId">
                        檢視/編輯次類別
                    </button>
                </td>
            </tr>
        }
    </tbody>
</table>
<!-- Modal -->
<div class="modal fade" id="exampleModal2" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">商品次類別編輯</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body showSub">
                <h4>目前已有的次分類</h4><br>
            </div>
            <hr>
            <div class="modal-body">
                <label>輸入欲新增的次類別名稱</label><span>: </span><input class="form-text txtSubCategory" type="text" value="">
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">關閉</button>
                <button type="button" class="btn btn-primary " id="Add">更新</button>
            </div>
        </div>
    </div>
</div>

@section Scripts
{
    <script>
            //新增商品主分類:寫法2:
            @*let btnAdd = document.querySelector('#update');

            btnAdd.addEventListener('click', () =>
            {
                console.log('update');
                let formData = new FormData(document.categoryInfo);


            fetch('@Url.Content("~/Category/Create")',
            {
                method: 'POST',
                    body: formData
                }).then(response => response.text())

            })*@

        //新增商品主分類:寫法1:
        $('#update').on("click", function ()
        {
            let Categoryname = $('#txtCategory').val();
            //console.log(Categoryname);
            $.post('@Url.Content("~/Admin/Category/CreateCategory")', { "categoryname": Categoryname}, function (datas)
            {
                //console.log(datas);
                window.location.href = 'List';  //refresh此頁
            })
       })

        //編輯商品次分類
       $(document).on("click", ".btnEdit", function ()
       {
           $('.showSub').empty();

           let CategoryId = $(this).attr("id");
           //console.log(CategoryId);

           $.get('@Url.Content("~/Admin/Category/ShowSubcategory")', { "categoryID": CategoryId }, function (datas) {
               //console.log(datas);
               $.each(datas, function (idx, item)
               {
                   //console.log(item.FSubCategoryName);
                   $('.showSub').append(`${item.FSubCategoryName}<br>`);
                   $('#Add').attr("class", `${item.FCategoryId}`)
               })
           })
       })
        //新增商品次分類
        $('#Add').on('click', function ()
        {
            let subcategoryname = $('.txtSubCategory').val();
            console.log(subcategoryname);
            let categoryID = $('#Add').attr("class");
            console.log(categoryID);

            $.post('@Url.Content("~/Admin/Category/CreateSubcategory")', { "Subcategoryname": subcategoryname, "Subcategoryname": subcategoryname, "CategoryID": categoryID}, function (datas)
            {
                console.log(datas);
                //window.location.href = 'List';  //refresh此頁
            })
        })

    </script>
}
